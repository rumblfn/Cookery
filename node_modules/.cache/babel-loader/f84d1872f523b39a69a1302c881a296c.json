{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar LRU_1 = require(\"./utils/LRU\");\n\nvar CACHE_SIZE = 1000;\n/**\n * Inspired node-lru-cache[https://github.com/isaacs/node-lru-cache]\n */\n\nvar EndpointCache =\n/** @class */\nfunction () {\n  function EndpointCache(maxSize) {\n    if (maxSize === void 0) {\n      maxSize = CACHE_SIZE;\n    }\n\n    this.maxSize = maxSize;\n    this.cache = new LRU_1.LRUCache(maxSize);\n  }\n\n  ;\n  Object.defineProperty(EndpointCache.prototype, \"size\", {\n    get: function () {\n      return this.cache.length;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  EndpointCache.prototype.put = function (key, value) {\n    var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n    var endpointRecord = this.populateValue(value);\n    this.cache.put(keyString, endpointRecord);\n  };\n\n  EndpointCache.prototype.get = function (key) {\n    var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n    var now = Date.now();\n    var records = this.cache.get(keyString);\n\n    if (records) {\n      for (var i = records.length - 1; i >= 0; i--) {\n        var record = records[i];\n\n        if (record.Expire < now) {\n          records.splice(i, 1);\n        }\n      }\n\n      if (records.length === 0) {\n        this.cache.remove(keyString);\n        return undefined;\n      }\n    }\n\n    return records;\n  };\n\n  EndpointCache.getKeyString = function (key) {\n    var identifiers = [];\n    var identifierNames = Object.keys(key).sort();\n\n    for (var i = 0; i < identifierNames.length; i++) {\n      var identifierName = identifierNames[i];\n      if (key[identifierName] === undefined) continue;\n      identifiers.push(key[identifierName]);\n    }\n\n    return identifiers.join(' ');\n  };\n\n  EndpointCache.prototype.populateValue = function (endpoints) {\n    var now = Date.now();\n    return endpoints.map(function (endpoint) {\n      return {\n        Address: endpoint.Address || '',\n        Expire: now + (endpoint.CachePeriodInMinutes || 1) * 60 * 1000\n      };\n    });\n  };\n\n  EndpointCache.prototype.empty = function () {\n    this.cache.empty();\n  };\n\n  EndpointCache.prototype.remove = function (key) {\n    var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n    this.cache.remove(keyString);\n  };\n\n  return EndpointCache;\n}();\n\nexports.EndpointCache = EndpointCache;","map":{"version":3,"sources":["/Users/samilvaliahmetov/education/programming/schoolProject/my-app/node_modules/aws-sdk/vendor/endpoint-cache/index.js"],"names":["Object","defineProperty","exports","value","LRU_1","require","CACHE_SIZE","EndpointCache","maxSize","cache","LRUCache","prototype","get","length","enumerable","configurable","put","key","keyString","getKeyString","endpointRecord","populateValue","now","Date","records","i","record","Expire","splice","remove","undefined","identifiers","identifierNames","keys","sort","identifierName","push","join","endpoints","map","endpoint","Address","CachePeriodInMinutes","empty"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar LRU_1 = require(\"./utils/LRU\");\nvar CACHE_SIZE = 1000;\n/**\n * Inspired node-lru-cache[https://github.com/isaacs/node-lru-cache]\n */\nvar EndpointCache = /** @class */ (function () {\n    function EndpointCache(maxSize) {\n        if (maxSize === void 0) { maxSize = CACHE_SIZE; }\n        this.maxSize = maxSize;\n        this.cache = new LRU_1.LRUCache(maxSize);\n    }\n    ;\n    Object.defineProperty(EndpointCache.prototype, \"size\", {\n        get: function () {\n            return this.cache.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    EndpointCache.prototype.put = function (key, value) {\n      var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n        var endpointRecord = this.populateValue(value);\n        this.cache.put(keyString, endpointRecord);\n    };\n    EndpointCache.prototype.get = function (key) {\n      var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n        var now = Date.now();\n        var records = this.cache.get(keyString);\n        if (records) {\n            for (var i = records.length-1; i >= 0; i--) {\n                var record = records[i];\n                if (record.Expire < now) {\n                    records.splice(i, 1);\n                }\n            }\n            if (records.length === 0) {\n                this.cache.remove(keyString);\n                return undefined;\n            }\n        }\n        return records;\n    };\n    EndpointCache.getKeyString = function (key) {\n        var identifiers = [];\n        var identifierNames = Object.keys(key).sort();\n        for (var i = 0; i < identifierNames.length; i++) {\n            var identifierName = identifierNames[i];\n            if (key[identifierName] === undefined)\n                continue;\n            identifiers.push(key[identifierName]);\n        }\n        return identifiers.join(' ');\n    };\n    EndpointCache.prototype.populateValue = function (endpoints) {\n        var now = Date.now();\n        return endpoints.map(function (endpoint) { return ({\n            Address: endpoint.Address || '',\n            Expire: now + (endpoint.CachePeriodInMinutes || 1) * 60 * 1000\n        }); });\n    };\n    EndpointCache.prototype.empty = function () {\n        this.cache.empty();\n    };\n    EndpointCache.prototype.remove = function (key) {\n      var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n        this.cache.remove(keyString);\n    };\n    return EndpointCache;\n}());\nexports.EndpointCache = EndpointCache;"]},"metadata":{},"sourceType":"script"}