{"ast":null,"code":"var AWS = require('../core');\n\nvar regionUtil = require('../region_config');\n\nvar s3util = {\n  /**\n   * @api private\n   */\n  isArnInParam: function isArnInParam(req, paramName) {\n    var inputShape = (req.service.api.operations[req.operation] || {}).input || {};\n    var inputMembers = inputShape.members || {};\n    if (!req.params[paramName] || !inputMembers[paramName]) return false;\n    return AWS.util.ARN.validate(req.params[paramName]);\n  },\n\n  /**\n   * Validate service component from ARN supplied in Bucket parameter\n   */\n  validateArnService: function validateArnService(req) {\n    var parsedArn = req._parsedArn;\n\n    if (parsedArn.service !== 's3' && parsedArn.service !== 's3-outposts' && parsedArn.service !== 's3-object-lambda') {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'expect \\'s3\\' or \\'s3-outposts\\' or \\'s3-object-lambda\\' in ARN service component'\n      });\n    }\n  },\n\n  /**\n   * Validate account ID from ARN supplied in Bucket parameter is a valid account\n   */\n  validateArnAccount: function validateArnAccount(req) {\n    var parsedArn = req._parsedArn;\n\n    if (!/[0-9]{12}/.exec(parsedArn.accountId)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'ARN accountID does not match regex \"[0-9]{12}\"'\n      });\n    }\n  },\n\n  /**\n   * Validate ARN supplied in Bucket parameter is a valid access point ARN\n   */\n  validateS3AccessPointArn: function validateS3AccessPointArn(req) {\n    var parsedArn = req._parsedArn; //can be ':' or '/'\n\n    var delimiter = parsedArn.resource['accesspoint'.length];\n\n    if (parsedArn.resource.split(delimiter).length !== 2) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Access Point ARN should have one resource accesspoint/{accesspointName}'\n      });\n    }\n\n    var accessPoint = parsedArn.resource.split(delimiter)[1];\n    var accessPointPrefix = accessPoint + '-' + parsedArn.accountId;\n\n    if (!s3util.dnsCompatibleBucketName(accessPointPrefix) || accessPointPrefix.match(/\\./)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Access point resource in ARN is not DNS compatible. Got ' + accessPoint\n      });\n    } //set parsed valid access point\n\n\n    req._parsedArn.accessPoint = accessPoint;\n  },\n\n  /**\n   * Validate Outposts ARN supplied in Bucket parameter is a valid outposts ARN\n   */\n  validateOutpostsArn: function validateOutpostsArn(req) {\n    var parsedArn = req._parsedArn;\n\n    if (parsedArn.resource.indexOf('outpost:') !== 0 && parsedArn.resource.indexOf('outpost/') !== 0) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'ARN resource should begin with \\'outpost/\\''\n      });\n    } //can be ':' or '/'\n\n\n    var delimiter = parsedArn.resource['outpost'.length];\n    var outpostId = parsedArn.resource.split(delimiter)[1];\n    var dnsHostRegex = new RegExp(/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])$/);\n\n    if (!dnsHostRegex.test(outpostId)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Outpost resource in ARN is not DNS compatible. Got ' + outpostId\n      });\n    }\n\n    req._parsedArn.outpostId = outpostId;\n  },\n\n  /**\n   * Validate Outposts ARN supplied in Bucket parameter is a valid outposts ARN\n   */\n  validateOutpostsAccessPointArn: function validateOutpostsAccessPointArn(req) {\n    var parsedArn = req._parsedArn; //can be ':' or '/'\n\n    var delimiter = parsedArn.resource['outpost'.length];\n\n    if (parsedArn.resource.split(delimiter).length !== 4) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Outposts ARN should have two resources outpost/{outpostId}/accesspoint/{accesspointName}'\n      });\n    }\n\n    var accessPoint = parsedArn.resource.split(delimiter)[3];\n    var accessPointPrefix = accessPoint + '-' + parsedArn.accountId;\n\n    if (!s3util.dnsCompatibleBucketName(accessPointPrefix) || accessPointPrefix.match(/\\./)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Access point resource in ARN is not DNS compatible. Got ' + accessPoint\n      });\n    } //set parsed valid access point\n\n\n    req._parsedArn.accessPoint = accessPoint;\n  },\n\n  /**\n   * Validate region field in ARN supplied in Bucket parameter is a valid region\n   */\n  validateArnRegion: function validateArnRegion(req, options) {\n    if (options === undefined) {\n      options = {};\n    }\n\n    var useArnRegion = s3util.loadUseArnRegionConfig(req);\n    var regionFromArn = req._parsedArn.region;\n    var clientRegion = req.service.config.region;\n    var useFipsEndpoint = req.service.config.useFipsEndpoint;\n    var allowFipsEndpoint = options.allowFipsEndpoint || false;\n\n    if (!regionFromArn) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'ARN region is empty'\n      });\n    }\n\n    if (useFipsEndpoint && !allowFipsEndpoint) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'ARN endpoint is not compatible with FIPS region'\n      });\n    }\n\n    if (regionFromArn.indexOf('fips') >= 0) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'FIPS region not allowed in ARN'\n      });\n    }\n\n    if (!useArnRegion && regionFromArn !== clientRegion) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Configured region conflicts with access point region'\n      });\n    } else if (useArnRegion && regionUtil.getEndpointSuffix(regionFromArn) !== regionUtil.getEndpointSuffix(clientRegion)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Configured region and access point region not in same partition'\n      });\n    }\n\n    if (req.service.config.useAccelerateEndpoint) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'useAccelerateEndpoint config is not supported with access point ARN'\n      });\n    }\n\n    if (req._parsedArn.service === 's3-outposts' && req.service.config.useDualstackEndpoint) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Dualstack is not supported with outposts access point ARN'\n      });\n    }\n  },\n  loadUseArnRegionConfig: function loadUseArnRegionConfig(req) {\n    var envName = 'AWS_S3_USE_ARN_REGION';\n    var configName = 's3_use_arn_region';\n    var useArnRegion = true;\n    var originalConfig = req.service._originalConfig || {};\n\n    if (req.service.config.s3UseArnRegion !== undefined) {\n      return req.service.config.s3UseArnRegion;\n    } else if (originalConfig.s3UseArnRegion !== undefined) {\n      useArnRegion = originalConfig.s3UseArnRegion === true;\n    } else if (AWS.util.isNode()) {\n      //load from environmental variable AWS_USE_ARN_REGION\n      if (process.env[envName]) {\n        var value = process.env[envName].trim().toLowerCase();\n\n        if (['false', 'true'].indexOf(value) < 0) {\n          throw AWS.util.error(new Error(), {\n            code: 'InvalidConfiguration',\n            message: envName + ' only accepts true or false. Got ' + process.env[envName],\n            retryable: false\n          });\n        }\n\n        useArnRegion = value === 'true';\n      } else {\n        //load from shared config property use_arn_region\n        var profiles = {};\n        var profile = {};\n\n        try {\n          profiles = AWS.util.getProfilesFromSharedConfig(AWS.util.iniLoader);\n          profile = profiles[process.env.AWS_PROFILE || AWS.util.defaultProfile];\n        } catch (e) {}\n\n        if (profile[configName]) {\n          if (['false', 'true'].indexOf(profile[configName].trim().toLowerCase()) < 0) {\n            throw AWS.util.error(new Error(), {\n              code: 'InvalidConfiguration',\n              message: configName + ' only accepts true or false. Got ' + profile[configName],\n              retryable: false\n            });\n          }\n\n          useArnRegion = profile[configName].trim().toLowerCase() === 'true';\n        }\n      }\n    }\n\n    req.service.config.s3UseArnRegion = useArnRegion;\n    return useArnRegion;\n  },\n\n  /**\n   * Validations before URI can be populated\n   */\n  validatePopulateUriFromArn: function validatePopulateUriFromArn(req) {\n    if (req.service._originalConfig && req.service._originalConfig.endpoint) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Custom endpoint is not compatible with access point ARN'\n      });\n    }\n\n    if (req.service.config.s3ForcePathStyle) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Cannot construct path-style endpoint with access point'\n      });\n    }\n  },\n\n  /**\n   * Returns true if the bucket name is DNS compatible.  Buckets created\n   * outside of the classic region MUST be DNS compatible.\n   *\n   * @api private\n   */\n  dnsCompatibleBucketName: function dnsCompatibleBucketName(bucketName) {\n    var b = bucketName;\n    var domain = new RegExp(/^[a-z0-9][a-z0-9\\.\\-]{1,61}[a-z0-9]$/);\n    var ipAddress = new RegExp(/(\\d+\\.){3}\\d+/);\n    var dots = new RegExp(/\\.\\./);\n    return b.match(domain) && !b.match(ipAddress) && !b.match(dots) ? true : false;\n  }\n};\n/**\n * @api private\n */\n\nmodule.exports = s3util;","map":{"version":3,"sources":["/Users/samilvaliahmetov/education/programming/schoolProject/my-app/node_modules/aws-sdk/lib/services/s3util.js"],"names":["AWS","require","regionUtil","s3util","isArnInParam","req","paramName","inputShape","service","api","operations","operation","input","inputMembers","members","params","util","ARN","validate","validateArnService","parsedArn","_parsedArn","error","Error","code","message","validateArnAccount","exec","accountId","validateS3AccessPointArn","delimiter","resource","length","split","accessPoint","accessPointPrefix","dnsCompatibleBucketName","match","validateOutpostsArn","indexOf","outpostId","dnsHostRegex","RegExp","test","validateOutpostsAccessPointArn","validateArnRegion","options","undefined","useArnRegion","loadUseArnRegionConfig","regionFromArn","region","clientRegion","config","useFipsEndpoint","allowFipsEndpoint","getEndpointSuffix","useAccelerateEndpoint","useDualstackEndpoint","envName","configName","originalConfig","_originalConfig","s3UseArnRegion","isNode","process","env","value","trim","toLowerCase","retryable","profiles","profile","getProfilesFromSharedConfig","iniLoader","AWS_PROFILE","defaultProfile","e","validatePopulateUriFromArn","endpoint","s3ForcePathStyle","bucketName","b","domain","ipAddress","dots","module","exports"],"mappings":"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","sourcesContent":["var AWS = require('../core');\nvar regionUtil = require('../region_config');\n\nvar s3util = {\n  /**\n   * @api private\n   */\n  isArnInParam: function isArnInParam(req, paramName) {\n    var inputShape = (req.service.api.operations[req.operation] || {}).input || {};\n    var inputMembers = inputShape.members || {};\n    if (!req.params[paramName] || !inputMembers[paramName]) return false;\n    return AWS.util.ARN.validate(req.params[paramName]);\n  },\n\n  /**\n   * Validate service component from ARN supplied in Bucket parameter\n   */\n  validateArnService: function validateArnService(req) {\n    var parsedArn = req._parsedArn;\n\n    if (parsedArn.service !== 's3'\n      && parsedArn.service !== 's3-outposts'\n      && parsedArn.service !== 's3-object-lambda') {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'expect \\'s3\\' or \\'s3-outposts\\' or \\'s3-object-lambda\\' in ARN service component'\n      });\n    }\n  },\n\n  /**\n   * Validate account ID from ARN supplied in Bucket parameter is a valid account\n   */\n  validateArnAccount: function validateArnAccount(req) {\n    var parsedArn = req._parsedArn;\n\n    if (!/[0-9]{12}/.exec(parsedArn.accountId)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'ARN accountID does not match regex \"[0-9]{12}\"'\n      });\n    }\n  },\n\n  /**\n   * Validate ARN supplied in Bucket parameter is a valid access point ARN\n   */\n  validateS3AccessPointArn: function validateS3AccessPointArn(req) {\n    var parsedArn = req._parsedArn;\n\n    //can be ':' or '/'\n    var delimiter = parsedArn.resource['accesspoint'.length];\n\n    if (parsedArn.resource.split(delimiter).length !== 2) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Access Point ARN should have one resource accesspoint/{accesspointName}'\n      });\n    }\n\n    var accessPoint = parsedArn.resource.split(delimiter)[1];\n    var accessPointPrefix = accessPoint + '-' + parsedArn.accountId;\n    if (!s3util.dnsCompatibleBucketName(accessPointPrefix) || accessPointPrefix.match(/\\./)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Access point resource in ARN is not DNS compatible. Got ' + accessPoint\n      });\n    }\n\n    //set parsed valid access point\n    req._parsedArn.accessPoint = accessPoint;\n  },\n\n  /**\n   * Validate Outposts ARN supplied in Bucket parameter is a valid outposts ARN\n   */\n  validateOutpostsArn: function validateOutpostsArn(req) {\n    var parsedArn = req._parsedArn;\n\n    if (\n      parsedArn.resource.indexOf('outpost:') !== 0 &&\n      parsedArn.resource.indexOf('outpost/') !== 0\n    ) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'ARN resource should begin with \\'outpost/\\''\n      });\n    }\n\n    //can be ':' or '/'\n    var delimiter = parsedArn.resource['outpost'.length];\n    var outpostId = parsedArn.resource.split(delimiter)[1];\n    var dnsHostRegex = new RegExp(/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])$/);\n    if (!dnsHostRegex.test(outpostId)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Outpost resource in ARN is not DNS compatible. Got ' + outpostId\n      });\n    }\n    req._parsedArn.outpostId = outpostId;\n  },\n\n  /**\n   * Validate Outposts ARN supplied in Bucket parameter is a valid outposts ARN\n   */\n  validateOutpostsAccessPointArn: function validateOutpostsAccessPointArn(req) {\n    var parsedArn = req._parsedArn;\n\n    //can be ':' or '/'\n    var delimiter = parsedArn.resource['outpost'.length];\n\n    if (parsedArn.resource.split(delimiter).length !== 4) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Outposts ARN should have two resources outpost/{outpostId}/accesspoint/{accesspointName}'\n      });\n    }\n\n    var accessPoint = parsedArn.resource.split(delimiter)[3];\n    var accessPointPrefix = accessPoint + '-' + parsedArn.accountId;\n    if (!s3util.dnsCompatibleBucketName(accessPointPrefix) || accessPointPrefix.match(/\\./)) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'Access point resource in ARN is not DNS compatible. Got ' + accessPoint\n      });\n    }\n\n    //set parsed valid access point\n    req._parsedArn.accessPoint = accessPoint;\n  },\n\n  /**\n   * Validate region field in ARN supplied in Bucket parameter is a valid region\n   */\n  validateArnRegion: function validateArnRegion(req, options) {\n    if (options === undefined) {\n      options = {};\n    }\n\n    var useArnRegion = s3util.loadUseArnRegionConfig(req);\n    var regionFromArn = req._parsedArn.region;\n    var clientRegion = req.service.config.region;\n    var useFipsEndpoint = req.service.config.useFipsEndpoint;\n    var allowFipsEndpoint = options.allowFipsEndpoint || false;\n\n    if (!regionFromArn) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidARN',\n        message: 'ARN region is empty'\n      });\n    }\n\n    if (useFipsEndpoint && !allowFipsEndpoint) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'ARN endpoint is not compatible with FIPS region'\n      });\n    }\n\n    if (regionFromArn.indexOf('fips') >= 0) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'FIPS region not allowed in ARN'\n      });\n    }\n\n    if (!useArnRegion && regionFromArn !== clientRegion) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Configured region conflicts with access point region'\n      });\n    } else if (\n      useArnRegion &&\n      regionUtil.getEndpointSuffix(regionFromArn) !== regionUtil.getEndpointSuffix(clientRegion)\n    ) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Configured region and access point region not in same partition'\n      });\n    }\n\n    if (req.service.config.useAccelerateEndpoint) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'useAccelerateEndpoint config is not supported with access point ARN'\n      });\n    }\n\n    if (req._parsedArn.service === 's3-outposts' && req.service.config.useDualstackEndpoint) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Dualstack is not supported with outposts access point ARN'\n      });\n    }\n  },\n\n  loadUseArnRegionConfig: function loadUseArnRegionConfig(req) {\n    var envName = 'AWS_S3_USE_ARN_REGION';\n    var configName = 's3_use_arn_region';\n    var useArnRegion = true;\n    var originalConfig = req.service._originalConfig || {};\n    if (req.service.config.s3UseArnRegion !== undefined) {\n      return req.service.config.s3UseArnRegion;\n    } else if (originalConfig.s3UseArnRegion !== undefined) {\n      useArnRegion = originalConfig.s3UseArnRegion === true;\n    } else if (AWS.util.isNode()) {\n      //load from environmental variable AWS_USE_ARN_REGION\n      if (process.env[envName]) {\n        var value = process.env[envName].trim().toLowerCase();\n        if (['false', 'true'].indexOf(value) < 0) {\n          throw AWS.util.error(new Error(), {\n            code: 'InvalidConfiguration',\n            message: envName + ' only accepts true or false. Got ' + process.env[envName],\n            retryable: false\n          });\n        }\n        useArnRegion = value === 'true';\n      } else {  //load from shared config property use_arn_region\n        var profiles = {};\n        var profile = {};\n        try {\n          profiles = AWS.util.getProfilesFromSharedConfig(AWS.util.iniLoader);\n          profile = profiles[process.env.AWS_PROFILE || AWS.util.defaultProfile];\n        } catch (e) {}\n        if (profile[configName]) {\n          if (['false', 'true'].indexOf(profile[configName].trim().toLowerCase()) < 0) {\n            throw AWS.util.error(new Error(), {\n              code: 'InvalidConfiguration',\n              message: configName + ' only accepts true or false. Got ' + profile[configName],\n              retryable: false\n            });\n          }\n          useArnRegion = profile[configName].trim().toLowerCase() === 'true';\n        }\n      }\n    }\n    req.service.config.s3UseArnRegion = useArnRegion;\n    return useArnRegion;\n  },\n\n  /**\n   * Validations before URI can be populated\n   */\n  validatePopulateUriFromArn: function validatePopulateUriFromArn(req) {\n    if (req.service._originalConfig && req.service._originalConfig.endpoint) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Custom endpoint is not compatible with access point ARN'\n      });\n    }\n\n    if (req.service.config.s3ForcePathStyle) {\n      throw AWS.util.error(new Error(), {\n        code: 'InvalidConfiguration',\n        message: 'Cannot construct path-style endpoint with access point'\n      });\n    }\n  },\n\n  /**\n   * Returns true if the bucket name is DNS compatible.  Buckets created\n   * outside of the classic region MUST be DNS compatible.\n   *\n   * @api private\n   */\n  dnsCompatibleBucketName: function dnsCompatibleBucketName(bucketName) {\n    var b = bucketName;\n    var domain = new RegExp(/^[a-z0-9][a-z0-9\\.\\-]{1,61}[a-z0-9]$/);\n    var ipAddress = new RegExp(/(\\d+\\.){3}\\d+/);\n    var dots = new RegExp(/\\.\\./);\n    return (b.match(domain) && !b.match(ipAddress) && !b.match(dots)) ? true : false;\n  },\n};\n\n/**\n * @api private\n */\nmodule.exports = s3util;\n"]},"metadata":{},"sourceType":"script"}